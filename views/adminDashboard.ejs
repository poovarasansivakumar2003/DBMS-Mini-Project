<%- include('includes/header') %>
<div class="bg-blue-50 flex flex-col md:flex-row min-h-screen">
  <aside class="bg-white shadow-md md:fixed md:h-screen z-20 overflow-y-auto w-full md:w-1/5">
    <div class="py-2">
      <ul class="space-y-0.5 px-2">
        <% const navItems = [
          { href: "#", icon: "fa-tachometer-alt", label: "Dashboard" },
          { href: "#manageCustomers", icon: "fa-users", label: "Manage Customers" },
          { href: "#addNewMedicines", icon: "fa-pills", label: "Add New Medicines" },
          { href: "#manageMedicines", icon: "fa-capsules", label: "Manage Medicines" },
          { href: "#addNewSuppliers", icon: "fa-truck", label: "Add New Suppliers" },
          { href: "#manageSuppliers", icon: "fa-building", label: "Manage Suppliers" },
          { href: "#makePurchases", icon: "fa-shopping-cart", label: "Make Purchases" },
          { href: "#pendingPurchases", icon: "fa-clock", label: "Pending Purchases" },
          { href: "#groupPurchases", icon: "fa-layer-group", label: "Group Purchases" },
          { href: "#paymentHistory", icon: "fa-money-bill-wave", label: "Payment History" },
          { href: "#invoiceHistory", icon: "fa-file-invoice", label: "Invoice History" },
        ]; %>
        <% navItems.forEach(item => { %>
        <li>
          <a href="<%= item.href %>" class="flex items-center px-4 py-3 text-gray-700 hover:bg-blue-50 rounded-lg transition-colors group">
            <i class="fas <%= item.icon %> w-5 text-center mr-3 text-gray-500 group-hover:text-blue-600"></i>
            <span><%= item.label %></span>
          </a>
        </li>
        <% }) %>
      </ul>
    </div>
  </aside>
  <div class="w-full md:w-4/5 px-4 sm:px-6 lg:px-8 right-0 md:absolute overflow-y-auto">
    <main>
      <div class="mx-auto py-6">
        <!-- Dashboard Card -->
        <div class="bg-white shadow-sm rounded-lg p-6 mb-8">
          <div class="flex flex-col lg:flex-row justify-between items-center">
            <h2 class="text-lg font-semibold text-gray-800 mb-4 lg:mb-0">Admin Dashboard</h2>
            <div class="w-full lg:w-auto">
              <div class="flex items-center justify-between lg:justify-start space-x-4 bg-blue-50 px-4 py-2 rounded-lg">
                <div>
                  <h3 class="text-xs font-medium text-gray-500">Total Income</h3>
                  <p class="text-sm font-semibold text-gray-900">₹<%= totalIncome %></p>
                </div>
                <div class="h-8 w-px bg-gray-300 hidden sm:block"></div>
                <div>
                  <h3 class="text-xs font-medium text-gray-500">Your Income</h3>
                  <p class="text-sm font-semibold text-gray-900">₹<%= adminIncome %></p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Manage Customers -->
        <h2 id="manageCustomers" class="text-xl font-semibold text-gray-800 mb-6 flex items-center">
          <i class="fa-solid fa-users text-blue-600 mr-2"></i> Manage Customers
        </h2>

        <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center space-y-4 sm:space-y-0 mb-8">
          <a href="/customerRegister" class="inline-flex items-center justify-center px-4 py-2 text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd" />
            </svg>
            Add New Customer
          </a>
          <button type="button" class="inline-flex items-center justify-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M3 3a1 1 0 011-1h12a1 1 0 011 1v3a1 1 0 01-.293.707L12 11.414V15a1 1 0 01-.293.707l-2 2A1 1 0 018 17v-5.586L3.293 6.707A1 1 0 013 6V3z" clip-rule="evenodd" />
            </svg>
            Filter
          </button>
        </div>

        <% if (customers?.length > 0) { %>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          <% customers.forEach(customer => { %>
          <div class="rounded-lg bg-white border border-gray-200 shadow-md overflow-hidden hover:shadow-lg transition">
            <div class="p-5">
              <div class="flex items-center space-x-4">
                <img src="<%= customer.customer_photo %>" alt="Profile" class="w-16 h-16 rounded-full object-cover border-2 border-blue-200">
                <div>
                  <h3 class="text-lg font-semibold text-gray-900 mb-1"><%= customer.customer_name %></h3>
                  <p class="text-sm text-gray-500">ID: <%= customer.customer_id %></p>
                  <p class="text-sm text-gray-500">Joined: <%= customer.customer_created_at %></p>
                </div>
              </div>

              <div class="mt-4 grid grid-cols-2 gap-4">
                <div class="bg-blue-50 rounded p-3">
                  <p class="text-xs font-medium text-gray-500">Balance</p>
                  <p class="text-lg font-bold text-blue-600">₹<%= customer.customer_balance_amt %></p>
                </div>
                <div class="bg-green-50 rounded p-3">
                  <p class="text-xs font-medium text-gray-500">Total Spent</p>
                  <p class="text-lg font-bold text-green-600">₹<%= customer.total_amt_spent %></p>
                </div>
              </div>

              <div class="mt-4">
                <div class="flex flex-col space-y-1">
                  <div class="flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-gray-400 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                    </svg>
                    <span class="text-sm text-gray-600"><%= customer.customer_email %></span>
                  </div>
                  <div class="flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-gray-400 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
                    </svg>
                    <span class="text-sm text-gray-600"><%= customer.customer_ph_no %></span>
                  </div>
                </div>
              </div>
            </div>

            <div class="border-t border-gray-200 px-5 py-3 bg-gray-50">
              <button onclick="toggleTab('address-<%= customer.customer_id %>')" class="text-sm font-medium text-blue-600 hover:text-blue-800">
                Addresses (<%= customer.addresses.length %>)
              </button>
              <span class="px-2 text-gray-400">|</span>
              <button onclick="toggleTab('feedback-<%= customer.customer_id %>')" class="text-sm font-medium text-blue-600 hover:text-blue-800">
                Feedback (<%= customer.feedbacks.length %>)
              </button>
              <span class="px-2 text-gray-400">|</span>
              <button onclick="toggleTab('profile-<%= customer.customer_id %>')" class="text-sm font-medium text-blue-600 hover:text-blue-800">
                Edit Profile
              </button>
            </div>

            <div id="address-<%= customer.customer_id %>" class="hidden border-t border-gray-200 p-5">
              <div class="flex justify-between items-center mb-4">
                <h4 class="font-medium text-gray-700">Customer Addresses</h4>
                <button onclick="toggleTab('add-address-<%= customer.customer_id %>')" class="text-xs bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded-full">Add New</button>
              </div>

              <% customer.addresses.forEach(address => { %>
              <div class="mb-4 p-3 border border-gray-200 rounded-lg">
                <div class="flex justify-between items-start">
                  <div>
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                      <%= address.address_type %>
                    </span>
                    <p class="mt-2 text-sm text-gray-600">
                      <%= address.street %>, <%= address.city %>, <%= address.state %> - <%= address.zip_code %>
                    </p>
                  </div>
                  <div class="flex space-x-2">
                    <button onclick="toggleTab('edit-address-<%= address.customer_address_id %>')" class="text-xs bg-gray-100 hover:bg-gray-200 text-gray-800 px-2 py-1 rounded">
                      Edit
                    </button>
                    <form action="/admin/adminDashboard/customer/deleteOrEditCustomer" method="POST" class="inline">
                      <input type="hidden" name="customer_id" value="<%= customer.customer_id %>">
                      <input type="hidden" name="customer_address_id" value="<%= address.customer_address_id %>">
                      <button type="submit" name="action" value="deleteAddress" class="text-xs bg-red-100 hover:bg-red-200 text-red-800 px-2 py-1 rounded" onclick="return confirm('Are you sure you want to delete this address?')">
                        Delete
                      </button>
                    </form>
                  </div>
                </div>

                <div id="edit-address-<%= address.customer_address_id %>" class="hidden mt-4 border-t border-gray-200 pt-4">
                  <form action="/admin/adminDashboard/customer/deleteOrEditCustomer" method="POST" class="space-y-3">
                    <input type="hidden" name="customer_id" value="<%= customer.customer_id %>">
                    <input type="hidden" name="customer_address_id" value="<%= address.customer_address_id %>">
                    <div class="grid grid-cols-2 gap-3">
                      <div>
                        <label class="block text-xs font-medium text-gray-700 mb-1">Address Type</label>
                        <select name="address_type" required class="w-full text-sm border border-gray-300 rounded-md p-2">
                          <option value="Home" <%= address.address_type === 'Home' ? 'selected' : '' %>>Home</option>
                          <option value="Work" <%= address.address_type === 'Work' ? 'selected' : '' %>>Work</option>
                          <option value="Other" <%= address.address_type === 'Other' ? 'selected' : '' %>>Other</option>
                        </select>
                      </div>
                      <div>
                        <label class="block text-xs font-medium text-gray-700 mb-1">Street</label>
                        <input type="text" name="street" value="<%= address.street %>" required class="w-full text-sm border border-gray-300 rounded-md p-2">
                      </div>
                      <div>
                        <label class="block text-xs font-medium text-gray-700 mb-1">City</label>
                        <input type="text" name="city" value="<%= address.city %>" required class="w-full text-sm border border-gray-300 rounded-md p-2">
                      </div>
                      <div>
                        <label class="block text-xs font-medium text-gray-700 mb-1">State</label>
                        <input type="text" name="state" value="<%= address.state %>" required class="w-full text-sm border border-gray-300 rounded-md p-2">
                      </div>
                      <div>
                        <label class="block text-xs font-medium text-gray-700 mb-1">ZIP Code</label>
                        <input type="text" name="zip_code" value="<%= address.zip_code %>" required class="w-full text-sm border border-gray-300 rounded-md p-2">
                      </div>
                    </div>
                    <div class="flex justify-end space-x-2 mt-4">
                      <button type="button" onclick="toggleTab('edit-address-<%= address.customer_address_id %>')" class="text-xs bg-gray-200 text-gray-800 px-3 py-1.5 rounded">
                        Cancel
                      </button>
                      <button type="submit" name="action" value="editAddress" class="text-xs bg-blue-600 hover:bg-blue-700 text-white px-3 py-1.5 rounded">
                        Save Changes
                      </button>
                    </div>
                  </form>
                </div>
              </div>
              <% }); %>

              <div id="add-address-<%= customer.customer_id %>" class="hidden mt-4 border-t border-gray-200 pt-4">
                <h5 class="font-medium text-gray-700 mb-3">Add New Address</h5>
                <form action="/admin/adminDashboard/customer/deleteOrEditCustomer" method="POST" class="space-y-3">
                  <input type="hidden" name="customer_id" value="<%= customer.customer_id %>">
                  <div class="grid grid-cols-2 gap-3">
                    <div>
                      <label class="block text-xs font-medium text-gray-700 mb-1">Address Type</label>
                      <select name="address_type" required class="w-full text-sm border border-gray-300 rounded-md p-2">
                        <option value="Home">Home</option>
                        <option value="Work">Work</option>
                        <option value="Other">Other</option>
                      </select>
                    </div>
                    <div>
                      <label class="block text-xs font-medium text-gray-700 mb-1">Street</label>
                      <input type="text" name="street" required class="w-full text-sm border border-gray-300 rounded-md p-2">
                    </div>
                    <div>
                      <label class="block text-xs font-medium text-gray-700 mb-1">City</label>
                      <input type="text" name="city" required class="w-full text-sm border border-gray-300 rounded-md p-2">
                    </div>
                    <div>
                      <label class="block text-xs font-medium text-gray-700 mb-1">State</label>
                      <input type="text" name="state" required class="w-full text-sm border border-gray-300 rounded-md p-2">
                    </div>
                    <div>
                      <label class="block text-xs font-medium text-gray-700 mb-1">ZIP Code</label>
                      <input type="text" name="zip_code" required class="w-full text-sm border border-gray-300 rounded-md p-2">
                    </div>
                  </div>
                  <div class="flex justify-end space-x-2 mt-4">
                    <button type="button" onclick="toggleTab('add-address-<%= customer.customer_id %>')" class="text-xs bg-gray-200 text-gray-800 px-3 py-1.5 rounded">
                      Cancel
                    </button>
                    <button type="submit" name="action" value="addAddress" class="text-xs bg-blue-600 hover:bg-blue-700 text-white px-3 py-1.5 rounded">
                      Add Address
                    </button>
                  </div>
                </form>
              </div>
            </div>

            <div id="feedback-<%= customer.customer_id %>" class="hidden border-t border-gray-200 p-5">
              <h4 class="font-medium text-gray-700 mb-4">Customer Feedback</h4>

              <% if (customer.feedbacks.length === 0) { %>
              <p class="text-sm text-gray-500">No feedback available for this customer.</p>
              <% } %>

              <% customer.feedbacks.forEach(feedback => { %>
              <div class="mb-4 p-3 border border-gray-200 rounded-lg">
                <div class="flex justify-between items-start">
                  <div>
                    <div class="flex items-center">
                      <div class="flex">
                        <% for (let i = 1; i <= 5; i++) { %>
                        <svg class="h-4 w-4 <%= i <= feedback.rating ? 'text-yellow-400' : 'text-gray-300' %>" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                          <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                        </svg>
                        <% } %>
                      </div>
                      <span class="ml-2 text-xs text-gray-500"><%= feedback.feedback_date %></span>
                    </div>
                    <p class="mt-2 text-sm text-gray-600"><%= feedback.feedback_text %></p>
                  </div>
                  <div class="flex space-x-2">
                    <button onclick="toggleTab('edit-feedback-<%= feedback.feedback_id %>')" class="text-xs bg-gray-100 hover:bg-gray-200 text-gray-800 px-2 py-1 rounded">
                      Edit
                    </button>
                    <form action="/admin/adminDashboard/customer/deleteOrEditCustomer" method="POST" class="inline">
                      <input type="hidden" name="customer_id" value="<%= customer.customer_id %>">
                      <input type="hidden" name="feedback_id" value="<%= feedback.feedback_id %>">
                      <button type="submit" name="action" value="deleteFeedback" class="text-xs bg-red-100 hover:bg-red-200 text-red-800 px-2 py-1 rounded" onclick="return confirm('Are you sure you want to delete this feedback?')">
                        Delete
                      </button>
                    </form>
                  </div>
                </div>

                <div id="edit-feedback-<%= feedback.feedback_id %>" class="hidden mt-4 border-t border-gray-200 pt-4">
                  <form action="/admin/adminDashboard/customer/deleteOrEditCustomer" method="POST" class="space-y-3">
                    <input type="hidden" name="customer_id" value="<%= customer.customer_id %>">
                    <input type="hidden" name="feedback_id" value="<%= feedback.feedback_id %>">
                    <div>
                      <label class="block text-xs font-medium text-gray-700 mb-1">Rating (1-5)</label>
                      <select name="rating" required class="w-full text-sm border border-gray-300 rounded-md p-2">
                        <% for (let i = 1; i <= 5; i++) { %>
                        <option value="<%= i %>" <%= feedback.rating === i ? 'selected' : '' %>><%= i %> Star<%= i !== 1 ? 's' : '' %></option>
                        <% } %>
                      </select>
                    </div>
                    <div>
                      <label class="block text-xs font-medium text-gray-700 mb-1">Feedback</label>
                      <textarea name="feedback_text" required class="w-full text-sm border border-gray-300 rounded-md p-2 h-20"><%= feedback.feedback_text %></textarea>
                    </div>
                    <div class="flex justify-end space-x-2 mt-4">
                      <button type="button" onclick="toggleTab('edit-feedback-<%= feedback.feedback_id %>')" class="text-xs bg-gray-200 text-gray-800 px-3 py-1.5 rounded">
                        Cancel
                      </button>
                      <button type="submit" name="action" value="editFeedback" class="text-xs bg-blue-600 hover:bg-blue-700 text-white px-3 py-1.5 rounded">
                        Save Changes
                      </button>
                    </div>
                  </form>
                </div>
              </div>
              <% }); %>
            </div>

            <div id="profile-<%= customer.customer_id %>" class="hidden border-t border-gray-200 p-5">
              <h4 class="font-medium text-gray-700 mb-4">Edit Profile</h4>
              <form action="/admin/adminDashboard/customer/deleteOrEditCustomer" method="POST" enctype="multipart/form-data" class="space-y-3">
                <input type="hidden" name="customer_id" value="<%= customer.customer_id %>">
                <div class="flex items-center space-x-4">
                  <img src="<%= customer.customer_photo %>" alt="Profile" class="w-16 h-16 rounded-full object-cover border-2 border-gray-200">
                  <div>
                    <label class="block text-xs font-medium text-gray-700 mb-1">Profile Photo</label>
                    <input type="file" id="photo-<%= customer.customer_id %>" name="customer_photo" accept="image/*" class="text-xs" onchange="previewImage(event, 'customer-<%= customer.customer_id %>')">
                    <div class="mt-2 flex items-center">
                      <img id="preview-customer-<%= customer.customer_id %>" class="w-12 h-12 rounded-full border border-gray-300 object-cover hidden" alt="Preview">
                      <button type="button" id="remove-image-customer-<%= customer.customer_id %>" class="hidden ml-2 text-xs text-red-600" onclick="removeImage('customer-<%= customer.customer_id %>')">Remove</button>
                    </div>
                  </div>
                </div>
                <div class="grid grid-cols-2 gap-3">
                  <div>
                    <label class="block text-xs font-medium text-gray-700 mb-1">Name</label>
                    <input type="text" name="customer_name" value="<%= customer.customer_name %>" required class="w-full text-sm border border-gray-300 rounded-md p-2">
                  </div>
                  <div>
                    <label class="block text-xs font-medium text-gray-700 mb-1">Email</label>
                    <input type="email" name="customer_email" value="<%= customer.customer_email %>" required class="w-full text-sm border border-gray-300 rounded-md p-2">
                  </div>
                  <div>
                    <label class="block text-xs font-medium text-gray-700 mb-1">Phone</label>
                    <input type="text" name="customer_ph_no" value="<%= customer.customer_ph_no %>" required class="w-full text-sm border border-gray-300 rounded-md p-2">
                  </div>
                  <div>
                    <label class="block text-xs font-medium text-gray-700 mb-1">Balance Amount</label>
                    <div class="relative rounded-md shadow-sm">
                      <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <span class="text-gray-500 sm:text-sm">₹</span>
                      </div>
                      <input type="number" name="customer_balance_amt" value="<%= customer.customer_balance_amt %>" required class="w-full text-sm border border-gray-300 rounded-md pl-7 p-2">
                    </div>
                  </div>
                </div>
                <div class="flex justify-between space-x-2 mt-4">
                  <form action="/admin/adminDashboard/customer/deleteOrEditCustomer" method="POST" class="inline">
                    <input type="hidden" name="customer_id" value="<%= customer.customer_id %>">
                    <button type="submit" name="action" value="delete" class="text-xs bg-red-600 hover:bg-red-700 text-white px-3 py-1.5 rounded" onclick="return confirm('Are you sure you want to delete this customer?')">
                      Delete Profile
                    </button>
                  </form>
                  <div class="flex space-x-2">
                    <button type="button" onclick="toggleTab('profile-<%= customer.customer_id %>')" class="text-xs bg-gray-200 text-gray-800 px-3 py-1.5 rounded">
                      Cancel
                    </button>
                    <button type="submit" name="action" value="edit" class="text-xs bg-blue-600 hover:bg-blue-700 text-white px-3 py-1.5 rounded">
                      Save Changes
                    </button>
                  </div>
                </div>
              </form>
            </div>
          </div>
          <% }); %>
        </div>
        <% } else { %>
        <div class="text-center py-10">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
          </svg>
          <h3 class="mt-2 text-sm font-medium text-gray-900">No customers</h3>
          <p class="mt-1 text-sm text-gray-500">Get started by creating a new customer.</p>
          <div class="mt-6">
            <a href="/customerRegister" class="inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
              <svg xmlns="http://www.w3.org/2000/svg" class="-ml-1 mr-2 h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd" />
              </svg>
              Add Customer
            </a>
          </div>
        </div>
        <% } %>

        <h2 id="addNewMedicines" class="text-xl font-semibold text-gray-800 mt-6 mb-6"><i class="fa-solid fa-pills text-blue-600 mr-2"></i>Add New Medicine</h2>
        <div class="bg-white rounded-xl shadow-md p-6">
          <form action="/admin/adminDashboard/medicine/addMedicine" method="POST" enctype="multipart/form-data" class="space-y-5">
            <div>
              <label for="medicine_type" class="block text-sm font-medium text-gray-700 mb-1">Medicine Type</label>
              <select id="medicine_type" name="medicine_type" class="w-full bg-gray-50 border border-gray-300 rounded-lg px-4 py-2.5 focus:ring-blue-500 focus:border-blue-500">
                <option value="Tablet" selected>Tablet</option>
                <option value="Syrup">Syrup</option>
                <option value="Capsule">Capsule</option>
                <option value="Injection">Injection</option>
                <option value="Ointment">Ointment</option>
              </select>
            </div>

            <div>
              <label for="medicine_name" class="block text-sm font-medium text-gray-700 mb-1">Name</label>
              <input type="text" id="medicine_name" name="medicine_name" placeholder="Enter medicine name" required class="w-full bg-gray-50 border border-gray-300 rounded-lg px-4 py-2.5 focus:ring-blue-500 focus:border-blue-500">
            </div>

            <div>
              <label for="medicine_composition" class="block text-sm font-medium text-gray-700 mb-1">Composition</label>
              <input type="text" id="medicine_composition" name="medicine_composition" placeholder="Enter composition" required class="w-full bg-gray-50 border border-gray-300 rounded-lg px-4 py-2.5 focus:ring-blue-500 focus:border-blue-500">
            </div>

            <div class="grid grid-cols-2 gap-4">
              <div>
                <label for="medicine_price" class="block text-sm font-medium text-gray-700 mb-1">Price (₹)</label>
                <input type="number" id="medicine_price" name="medicine_price" placeholder="0.00" required class="w-full bg-gray-50 border border-gray-300 rounded-lg px-4 py-2.5 focus:ring-blue-500 focus:border-blue-500">
              </div>

              <div>
                <label for="medicine_expiry_date" class="block text-sm font-medium text-gray-700 mb-1">Expiry Date</label>
                <input type="date" id="medicine_expiry_date" name="medicine_expiry_date" required class="w-full bg-gray-50 border border-gray-300 rounded-lg px-4 py-2.5 focus:ring-blue-500 focus:border-blue-500">
              </div>
            </div>

            <div>
              <label for="medicine_img_input" class="block text-sm font-medium text-gray-700 mb-1">Medicine Image</label>
              <div class="flex items-center justify-center w-full">
                <label for="medicine_img_input" class="flex flex-col items-center justify-center w-full h-32 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100">
                  <div class="flex flex-col items-center justify-center pt-5 pb-6" id="upload-text">
                    <svg class="w-8 h-8 mb-3 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                    </svg>
                    <p class="mb-2 text-sm text-gray-500"><span class="font-semibold">Click to upload</span> or drag and drop</p>
                    <p class="text-xs text-gray-500">PNG, JPG or JPEG (MAX. 2MB)</p>
                  </div>
                  <img id="medicine_img_preview" class="absolute w-full h-32 object-cover rounded-lg hidden" alt="Image Preview">
                  <input id="medicine_img_input" name="medicine_img" type="file" class="hidden" accept="image/*" onchange="previewImage(event)" />
                </label>
              </div>
              <button type="button" id="remove_img_button" class="hidden mt-2 text-sm text-red-600 hover:text-red-800 font-medium" onclick="removeImage()">Remove Image</button>
            </div>

            <button type="submit" class="w-full flex justify-center items-center px-4 py-3 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-300 transition duration-200">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" />
              </svg>
              Add Medicine
            </button>
          </form>
        </div>

        <h2 id="manageMedicines" class="text-xl font-semibold text-gray-800 mb-4 mt-6"><i class="fa-solid fa-pills text-blue-600 mr-2"></i>Manage Medicines</h2>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6" id="medicine-list">
          <% if (medicines && medicines.length > 0) { %>
          <% medicines.forEach(medicine => { %>
          <div class="bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden hover:shadow-md transition duration-300">
            <div class="relative">
              <img src="<%= medicine.medicine_img %>" alt="<%= medicine.medicine_name %>" class="w-full h-48 object-cover">
              <div class="absolute top-2 right-2 bg-blue-600 text-white text-xs font-bold px-2 py-1 rounded-full">
                <%= medicine.medicine_type %>
              </div>
            </div>

            <div class="p-4">
              <div class="flex justify-between items-start mb-2">
                <h3 class="text-lg font-semibold text-gray-800 line-clamp-1"><%= medicine.medicine_name %></h3>
                <span class="text-gray-500 text-sm">#<%= medicine.medicine_id %></span>
              </div>

              <p class="text-sm text-gray-600 mb-2 line-clamp-1"><%= medicine.medicine_composition %></p>

              <div class="flex justify-between items-center mb-3">
                <span class="text-blue-600 font-bold text-lg">₹<%= medicine.medicine_price %></span>
                <span class="text-gray-600 text-sm">Stock: <%= medicine.total_stock %></span>
              </div>

              <div class="text-sm text-red-500 mb-4">
                Expiry: <%= new Date(medicine.medicine_expiry_date).toDateString() %>
              </div>

              <div class="flex gap-2">
                <button onclick="toggleEditForm('medicine-<%= medicine.medicine_id %>')" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium py-2 px-3 rounded focus:outline-none focus:ring-2 focus:ring-blue-300 transition duration-200">
                  Edit
                </button>
                <form action="/admin/adminDashboard/medicine/deleteOrEditMedicine" method="POST" class="flex-1">
                  <input type="hidden" name="medicine_id" value="<%= medicine.medicine_id %>">
                  <button type="submit" name="action" value="delete" class="w-full bg-red-600 hover:bg-red-700 text-white text-sm font-medium py-2 px-3 rounded focus:outline-none focus:ring-2 focus:ring-red-300 transition duration-200" onclick="return confirm('Are you sure you want to delete this medicine?')">
                    Delete
                  </button>
                </form>
              </div>
            </div>

            <div id="edit-form-medicine-<%= medicine.medicine_id %>" class="hidden border-t border-gray-200 p-4 bg-gray-50">
              <form action="/admin/adminDashboard/medicine/deleteOrEditMedicine" method="POST" enctype="multipart/form-data" class="space-y-4">
                <input type="hidden" name="medicine_id" value="<%= medicine.medicine_id %>">

                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Medicine Type</label>
                  <select name="medicine_type" required class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 focus:ring-blue-500 focus:border-blue-500">
                    <option value="Tablet" <%= medicine.medicine_type === 'Tablet' ? 'selected' : '' %>>Tablet</option>
                    <option value="Syrup" <%= medicine.medicine_type === 'Syrup' ? 'selected' : '' %>>Syrup</option>
                    <option value="Capsule" <%= medicine.medicine_type === 'Capsule' ? 'selected' : '' %>>Capsule</option>
                    <option value="Injection" <%= medicine.medicine_type === 'Injection' ? 'selected' : '' %>>Injection</option>
                    <option value="Ointment" <%= medicine.medicine_type === 'Ointment' ? 'selected' : '' %>>Ointment</option>
                  </select>
                </div>

                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Name</label>
                  <input type="text" name="medicine_name" value="<%= medicine.medicine_name %>" required class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 focus:ring-blue-500 focus:border-blue-500">
                </div>

                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Composition</label>
                  <input type="text" name="medicine_composition" value="<%= medicine.medicine_composition %>" required class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 focus:ring-blue-500 focus:border-blue-500">
                </div>

                <div class="grid grid-cols-2 gap-4">
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Price</label>
                    <input type="number" name="medicine_price" value="<%= medicine.medicine_price %>" required class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 focus:ring-blue-500 focus:border-blue-500">
                  </div>

                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Expiry Date</label>
                    <input type="date" name="medicine_expiry_date" value="<%= medicine.medicine_expiry_date.toISOString().split('T')[0] %>" required class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 focus:ring-blue-500 focus:border-blue-500">
                  </div>
                </div>

                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Update Image</label>
                  <input type="file" name="medicine_img" accept="image/*" class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2">
                </div>

                <div class="flex justify-end space-x-3">
                  <button type="button" onclick="toggleEditForm('medicine-<%= medicine.medicine_id %>')" class="px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-800 text-sm font-medium rounded focus:outline-none focus:ring-2 focus:ring-gray-300 transition duration-200">
                    Cancel
                  </button>
                  <button type="submit" name="action" value="edit" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white text-sm font-medium rounded focus:outline-none focus:ring-2 focus:ring-green-300 transition duration-200">
                    Save Changes
                  </button>
                </div>
              </form>
            </div>
          </div>
          <% }) %>
          <% } else { %>
          <div class="col-span-full flex flex-col items-center justify-center py-12">
            <svg class="w-16 h-16 text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
            </svg>
            <p class="text-lg font-medium text-gray-600">No medicines available</p>
            <p class="text-sm text-gray-500 mt-1">Add your first medicine to get started</p>
          </div>
          <% } %>
        </div>


        <h2 id="addNewSuppliers" class="text-xl font-semibold text-gray-800 mb-4 mt-6"><i class="fa-solid fa-truck text-blue-600 mr-2"></i>Add New Supplier</h2>
        <div class="bg-white rounded-xl shadow-md p-6">
          <form action="/admin/adminDashboard/supplier/addSupplier" method="POST" class="p-2">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Supplier Name</label>
                <input type="text" name="supplier_name" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                <input type="email" name="supplier_email" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Phone Number</label>
                <input type="text" name="supplier_ph_no" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
              </div>
            </div>

            <div class="mb-4">
              <h3 class="text-md font-medium text-gray-700 mb-2 border-b pb-1">Address Information</h3>
              <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Street</label>
                  <input type="text" name="street" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">City</label>
                  <input type="text" name="city" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">State</label>
                  <input type="text" name="state" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Zip Code</label>
                  <input type="text" name="zip_code" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
              </div>
            </div>

            <div class="flex justify-end">
              <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-md font-medium transition duration-200">
                Add Supplier
              </button>
            </div>
          </form>
        </div>

        <h2 id="manageSuppliers" class="text-xl font-semibold text-gray-800 mb-4 mt-6"><i class="fa-solid fa-building text-blue-600 mr-2"></i>Manage Suppliers</h2>
        <% if (suppliers.length > 0) { %>
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <% suppliers.forEach(supplier => { %>
          <div class="bg-white rounded-lg shadow-lg overflow-hidden">
            <div class="bg-blue-600 px-6 py-3 flex justify-between items-center">
              <h3 class="text-lg font-bold text-white">
                <%= supplier.supplier_name %>
              </h3>
              <span class="bg-white text-blue-600 px-2 py-1 rounded-md text-sm font-medium">
                ID: <%= supplier.supplier_id %>
              </span>
            </div>

            <div class="p-6">
              <div class="grid grid-cols-2 gap-4 mb-4">
                <div class="flex items-center">
                  <i class="fa-solid fa-envelope h-5 w-5 text-blue-500 mr-2"></i>
                  <div>
                    <p class="text-xs text-gray-500">Email</p>
                    <p class="text-gray-800"><%= supplier.supplier_email %></p>
                  </div>
                </div>
                <div class="flex items-center">
                  <i class="fa-solid fa-phone h-5 w-5 text-blue-500 mr-2"></i>
                  <div>
                    <p class="text-xs text-gray-500">Phone</p>
                    <p class="text-gray-800"><%= supplier.supplier_ph_no %></p>
                  </div>
                </div>
              </div>

              <!-- Supplier Actions -->
              <div class="flex space-x-2 mb-6">
                <button onclick="toggleEditForm('supplier-<%= supplier.supplier_id %>')" class="flex items-center justify-center px-3 py-2 bg-blue-100 text-blue-600 hover:bg-blue-200 rounded-md transition-colors text-sm flex-1">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 20 20" fill="currentColor">
                    <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z" />
                  </svg>
                  Edit Supplier
                </button>
                <form action="/admin/adminDashboard/supplier/deleteOrEditSupplier" method="POST" class="flex-1">
                  <input type="hidden" name="supplier_id" value="<%= supplier.supplier_id %>">
                  <button type="submit" name="action" value="delete" class="w-full flex items-center justify-center px-3 py-2 bg-red-100 text-red-600 hover:bg-red-200 rounded-md transition-colors text-sm" onclick="return confirm('Are you sure you want to delete this supplier?')">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 20 20" fill="currentColor">
                      <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
                    </svg>
                    Delete
                  </button>
                </form>
              </div>

              <!-- Edit Supplier Form -->
              <form id="edit-form-supplier-<%= supplier.supplier_id %>" action="/admin/adminDashboard/supplier/deleteOrEditSupplier" method="POST" class="hidden mb-6 p-4 bg-blue-50 rounded-lg border border-blue-100">
                <input type="hidden" name="supplier_id" value="<%= supplier.supplier_id %>">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Name</label>
                    <input type="text" name="supplier_name" value="<%= supplier.supplier_name %>" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                    <input type="email" name="supplier_email" value="<%= supplier.supplier_email %>" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Phone</label>
                    <input type="text" name="supplier_ph_no" value="<%= supplier.supplier_ph_no %>" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                  </div>
                </div>
                <div class="flex justify-end space-x-2">
                  <button type="button" onclick="toggleEditForm()" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300">Cancel</button>
                  <button type="submit" name="action" value="edit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">Save</button>
                </div>
              </form>

              <!-- Tabs -->
              <div class="border-b border-gray-200 mb-4">
                <ul class="flex -mb-px">
                  <li class="mr-1">
                    <button onclick="showTab('<%= supplier.supplier_id %>', 'addresses')" id="tab-addresses-<%= supplier.supplier_id %>" class="inline-block py-2 px-4 text-blue-600 font-medium border-blue-600 border-b-2">
                      Addresses
                    </button>
                  </li>
                  <li class="mr-1">
                    <button onclick="showTab('<%= supplier.supplier_id %>', 'medicines')" id="tab-medicines-<%= supplier.supplier_id %>" class="inline-block py-2 px-4 text-gray-500 hover:text-blue-600 font-medium border-transparent border-b-2 hover:border-blue-300">
                      Medicines
                    </button>
                  </li>
                </ul>
              </div>

              <!-- Addresses Tab -->
              <div id="tab-content-addresses-<%= supplier.supplier_id %>" class="tab-content">
                <div class="flex justify-between items-center mb-3">
                  <h4 class="font-medium text-gray-800">Supplier Addresses</h4>
                  <button onclick="toggleEditForm('addSupplierAddress-<%= supplier.supplier_id %>')" class="flex items-center text-sm px-3 py-1 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 20 20" fill="currentColor">
                      <path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd" />
                    </svg>
                    Add Address
                  </button>
                </div>

                <!-- Add Address Form -->
                <form id="edit-form-addSupplierAddress-<%= supplier.supplier_id %>" action="/admin/adminDashboard/supplier/deleteOrEditSupplier" method="POST" class="hidden mb-4 p-4 bg-blue-50 rounded-lg border border-blue-100">
                  <input type="hidden" name="supplier_id" value="<%= supplier.supplier_id %>">
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-3">
                    <div>
                      <label class="block text-sm font-medium text-gray-700 mb-1">Street</label>
                      <input type="text" name="street" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-gray-700 mb-1">City</label>
                      <input type="text" name="city" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-gray-700 mb-1">State</label>
                      <input type="text" name="state" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-gray-700 mb-1">ZIP Code</label>
                      <input type="text" name="zip_code" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                  </div>
                  <div class="flex justify-end space-x-2">
                    <button type="button" onclick="toggleEditForm()" class="px-3 py-1 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 text-sm">Cancel</button>
                    <button type="submit" name="action" value="addAddress" class="px-3 py-1 bg-blue-600 text-white rounded-md hover:bg-blue-700 text-sm">Add Address</button>
                  </div>
                </form>

                <% if (supplier.addresses.length > 0) { %>
                <div class="space-y-3">
                  <% supplier.addresses.forEach(address => { %>
                  <div class="bg-white border border-gray-200 rounded-lg p-3 shadow-sm">
                    <div class="flex flex-wrap items-center justify-between">
                      <div class="mb-2 sm:mb-0">
                        <p class="text-gray-800"><%= address.street %>, <%= address.city %>, <%= address.state %> <%= address.zip_code %></p>
                      </div>
                      <div class="flex space-x-2">
                        <button onclick="toggleEditForm('supplierAddress-<%= address.supplier_address_id %>')" class="text-xs px-2 py-1 bg-blue-100 text-blue-600 rounded hover:bg-blue-200">Edit</button>
                        <form action="/admin/adminDashboard/supplier/deleteOrEditSupplier" method="POST">
                          <input type="hidden" name="supplier_id" value="<%= supplier.supplier_id %>">
                          <input type="hidden" name="supplier_address_id" value="<%= address.supplier_address_id %>">
                          <button type="submit" name="action" value="deleteAddress" class="text-xs px-2 py-1 bg-red-100 text-red-600 rounded hover:bg-red-200" onclick="return confirm('Are you sure you want to delete this Address?')">Delete</button>
                        </form>
                      </div>
                    </div>

                    <!-- Edit Address Form -->
                    <form id="edit-form-supplierAddress-<%= address.supplier_address_id %>" action="/admin/adminDashboard/supplier/deleteOrEditSupplier" method="POST" class="hidden mt-3 pt-3 border-t border-gray-200">
                      <input type="hidden" name="supplier_id" value="<%= supplier.supplier_id %>">
                      <input type="hidden" name="supplier_address_id" value="<%= address.supplier_address_id %>">
                      <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mb-3">
                        <div>
                          <label class="block text-xs font-medium text-gray-700 mb-1">Street</label>
                          <input type="text" name="street" value="<%= address.street %>" required class="w-full px-3 py-1 text-sm border border-gray-300 rounded-md">
                        </div>
                        <div>
                          <label class="block text-xs font-medium text-gray-700 mb-1">City</label>
                          <input type="text" name="city" value="<%= address.city %>" required class="w-full px-3 py-1 text-sm border border-gray-300 rounded-md">
                        </div>
                        <div>
                          <label class="block text-xs font-medium text-gray-700 mb-1">State</label>
                          <input type="text" name="state" value="<%= address.state %>" required class="w-full px-3 py-1 text-sm border border-gray-300 rounded-md">
                        </div>
                        <div>
                          <label class="block text-xs font-medium text-gray-700 mb-1">Zip Code</label>
                          <input type="text" name="zip_code" value="<%= address.zip_code %>" required class="w-full px-3 py-1 text-sm border border-gray-300 rounded-md">
                        </div>
                      </div>
                      <div class="flex justify-end space-x-2">
                        <button type="button" onclick="toggleEditForm()" class="text-xs px-2 py-1 bg-gray-200 text-gray-700 rounded">Cancel</button>
                        <button type="submit" name="action" value="editAddress" class="text-xs px-2 py-1 bg-blue-600 text-white rounded">Save Changes</button>
                      </div>
                    </form>
                  </div>
                  <% }) %>
                </div>
                <% } else { %>
                <div class="bg-gray-50 rounded-lg p-4 text-center">
                  <p class="text-gray-500">No address available for this supplier.</p>
                </div>
                <% } %>
              </div>

              <!-- Medicines Tab -->
              <div id="tab-content-medicines-<%= supplier.supplier_id %>" class="tab-content hidden">
                <div class="flex justify-between items-center mb-3">
                  <h4 class="font-medium text-gray-800">Supplied Medicines</h4>
                  <button onclick="toggleEditForm('addStock-<%= supplier.supplier_id %>')" class="flex items-center text-sm px-3 py-1 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 20 20" fill="currentColor">
                      <path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd" />
                    </svg>
                    Add Stock
                  </button>
                </div>

                <!-- Add Stock Form -->
                <form id="edit-form-addStock-<%= supplier.supplier_id %>" action="/admin/adminDashboard/stocks/addStocks" method="POST" class="hidden mb-4 p-4 bg-blue-50 rounded-lg border border-blue-100">
                  <input type="hidden" name="supplier_id" value="<%= supplier.supplier_id %>">
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-3">
                    <div>
                      <label class="block text-sm font-medium text-gray-700 mb-1">Medicine</label>
                      <select name="medicine_id" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <% medicines.forEach(medicine => { %>
                        <option value="<%= medicine.medicine_id %>"><%= medicine.medicine_name %></option>
                        <% }) %>
                      </select>
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-gray-700 mb-1">Stock Quantity</label>
                      <input type="number" name="stock_quantity" min="1" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                  </div>
                  <div class="flex justify-end space-x-2">
                    <button type="button" onclick="toggleEditForm()" class="px-3 py-1 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 text-sm">Cancel</button>
                    <button type="submit" class="px-3 py-1 bg-blue-600 text-white rounded-md hover:bg-blue-700 text-sm">Add Stock</button>
                  </div>
                </form>

                <% if (supplier.medicines.length > 0) { %>
                <div class="space-y-3">
                  <% supplier.medicines.forEach(medicine => { %>
                  <div class="bg-white border border-gray-200 rounded-lg p-3 shadow-sm">
                    <div class="flex flex-wrap items-center justify-between">
                      <div>
                        <h5 class="font-medium text-gray-800"><%= medicine.medicine_name %></h5>
                        <p class="text-sm text-gray-600 mt-1">Current Stock: <span class="font-medium"><%= medicine.stock_quantity %></span> units</p>
                      </div>
                      <div class="flex space-x-2 mt-2 sm:mt-0">
                        <button onclick="toggleEditForm('editStock-<%= medicine.medicine_id %>')" class="text-xs px-2 py-1 bg-blue-100 text-blue-600 rounded hover:bg-blue-200">Edit</button>
                        <form action="/admin/adminDashboard/stocks/deleteOrEditStocks" method="POST">
                          <input type="hidden" name="supplier_id" value="<%= supplier.supplier_id %>">
                          <input type="hidden" name="medicine_id" value="<%= medicine.medicine_id %>">
                          <button type="submit" name="action" value="delete" class="text-xs px-2 py-1 bg-red-100 text-red-600 rounded hover:bg-red-200" onclick="return confirm('Are you sure you want to delete this medicine?')">Delete</button>
                        </form>
                      </div>
                    </div>

                    <!-- Edit Stock Form -->
                    <form id="edit-form-editStock-<%= medicine.medicine_id %>" action="/admin/adminDashboard/stocks/deleteOrEditStocks" method="POST" class="hidden mt-3 pt-3 border-t border-gray-200">
                      <input type="hidden" name="supplier_id" value="<%= supplier.supplier_id %>">
                      <input type="hidden" name="medicine_id" value="<%= medicine.medicine_id %>">
                      <div>
                        <label class="block text-xs font-medium text-gray-700 mb-1">Stock Quantity</label>
                        <div class="flex items-center space-x-2">
                          <input type="number" name="stock_quantity" value="<%= medicine.stock_quantity %>" required class="flex-grow px-3 py-1 text-sm border border-gray-300 rounded-md">
                          <button type="button" onclick="toggleEditForm()" class="text-xs px-2 py-1 bg-gray-200 text-gray-700 rounded">Cancel</button>
                          <button type="submit" name="action" value="edit" class="text-xs px-2 py-1 bg-blue-600 text-white rounded">Update</button>
                        </div>
                      </div>
                    </form>
                  </div>
                  <% }) %>
                </div>
                <% } else { %>
                <div class="bg-gray-50 rounded-lg p-4 text-center">
                  <p class="text-gray-500">No medicine supplied by this supplier.</p>
                </div>
                <% } %>
              </div>
            </div>
          </div>
          <% }) %>
          <% } else { %>
          <div class="bg-white rounded-lg shadow-lg p-8 text-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-blue-400 mx-auto mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
            </svg>
            <h3 class="text-xl font-medium text-gray-700 mb-2">No Suppliers Found</h3>
            <p class="text-gray-500">Add your first supplier using the form above.</p>
          </div>
          <% } %>
        </div>


        <h2 id="makePurchases" class="text-xl font-semibold text-gray-800 mb-4 mt-6"><i class="fa-solid fa-cart-shopping mr-2 text-blue-600"></i>Make Purchase</h2>
        <% if (medicinesForPurchase.length > 0) { %>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 xl:grid-cols-4 gap-6">
          <% medicinesForPurchase.forEach(medicine => { %>
          <div class="bg-white rounded-xl shadow-md overflow-hidden border border-gray-100 transition-all hover:shadow-lg hover:scale-[1.02]">
            <form action="/admin/adminDashboard/cart/addToCart" method="POST" class="h-full flex flex-col">
              <input type="hidden" name="medicine_id" value="<%= medicine.medicine_id %>">
              <div class="relative">
                <% if (medicine.medicine_img) { %>
                <img src="data:image/jpeg;base64,<%= medicine.medicine_img.toString('base64') %>" alt="<%= medicine.medicine_name %>" class="w-full h-48 object-cover">
                <% } else { %>
                <img src="/img/noImg.jpg" alt="No Image Available" class="w-full h-48 object-cover">
                <% } %>
                <div class="absolute top-2 right-2 bg-white px-2 py-1 rounded-full text-xs font-medium text-gray-700">
                  <%= medicine.medicine_type %>
                </div>
              </div>
              <div class="p-4 flex-grow flex flex-col">
                <div class="flex justify-between items-start mb-2">
                  <h3 class="text-lg font-semibold text-gray-800 line-clamp-1"><%= medicine.medicine_name %></h3>
                  <span class="text-gray-500 text-sm">#<%= medicine.medicine_id %></span>
                </div>
                <div class="flex justify-between items-start mb-2">
                  <p class="text-gray-600 text-sm mb-2 line-clamp-2"><%= medicine.medicine_composition %></p>
                  <span class="text-gray-600 text-sm">Stock: <%= medicine.total_stock %></span>
                </div>
                <div class="flex justify-between items-center mt-1 mb-3">

                  <p class="text-blue-600 font-bold text-xl">₹<%= medicine.medicine_price %></p>
                  <p class="text-rose-500 text-xs bg-rose-50 px-2 py-1 rounded-full">
                    Exp: <%= new Date(medicine.medicine_expiry_date).toDateString() %>
                  </p>
                </div>
                <div class="space-y-3 mt-auto">
                  <div class="w-full">
                    <label for="customer_id" class="block text-sm font-medium text-gray-700 mb-1">Customer</label>
                    <select name="customer_id" id="customer_id" class="w-full rounded-lg border-gray-300 text-sm focus:ring-blue-500 focus:border-blue-500">
                      <% customers.forEach(customer => { %>
                      <option value="<%= customer.customer_id %>">
                        <%= customer.customer_id %>: <%= customer.customer_name %>
                      </option>
                      <% }) %>
                    </select>
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1" for="supplier_id">Supplier</label>
                    <select name="supplier_id" class="w-full rounded-lg border-gray-300 text-sm focus:ring-blue-500 focus:border-blue-500">
                      <% medicine.suppliers.forEach(supplier => { %>
                      <% if (supplier.stock_quantity > 0) { %>
                      <option value="<%= supplier.supplier_id %>">
                        <%= supplier.supplier_id %>: <%= supplier.supplier_name %> (Stock: <%= supplier.stock_quantity %>)
                      </option>
                      <% } %>
                      <% }) %>
                    </select>
                  </div>

                  <div class="flex items-center">
                    <label for="purchased_quantity-<%= medicine.medicine_id %>" class="text-sm font-medium text-gray-700 mr-2">Quantity:</label>
                    <input type="number" name="purchased_quantity" id="purchased_quantity-<%= medicine.medicine_id %>" class="w-20 rounded-lg border-gray-300 text-sm focus:ring-blue-500 focus:border-blue-500" min="1" value="1">
                  </div>
                  <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition flex items-center justify-center">
                    <i class="fa-solid fa-cart-plus mr-2"></i> Add to Purchase
                  </button>
                </div>
              </div>
            </form>
          </div>
          <% }) %>
        </div>
        <% } else { %>
        <div class="py-12 text-center bg-white rounded-xl shadow-sm">
          <div class="text-gray-400 mb-3"><i class="fa-solid fa-shopping-cart text-5xl"></i></div>
          <p class="text-gray-500 text-lg">No medicines found</p>
        </div>
        <% } %>

        <h2 id="pendingPurchases" class="text-xl font-semibold text-gray-800 mb-4 mt-6"><i class="fa-solid fa-clock text-blue-600 mr-2"></i>Pending Purchase</h2>
        <% if (cartItems.length === 0) { %>
        <div class="py-12 text-center bg-white rounded-xl shadow-sm">
          <div class="text-gray-400 mb-3"><i class="fa-solid fa-shopping-cart text-5xl"></i></div>
          <p class="text-gray-500 text-lg">Cart is empty</p>
        </div>
        <% } %>
        <% if (cartItems.length > 0) { %>
        <div class="bg-white rounded-xl shadow-md overflow-hidden border border-gray-100">
          <div class="p-4 border-b border-gray-100 flex justify-between items-center bg-gradient-to-r from-blue-50 to-indigo-50">
            <div class="flex items-center space-x-4">
              <div class="flex items-center space-x-2">
                <i class="fa-solid fa-shopping-bag text-blue-600"></i>
                <p class="text-gray-700 font-medium">Total Sessions: <span class="font-bold text-blue-600"><%= cartItems.length %></span></p>
              </div>
              <div class="flex items-center space-x-2">
                <i class="fa-solid fa-hashtag text-blue-600"></i>
                <p class="text-gray-700 font-medium">Session ID:
                  <% cartItems.forEach(session => { %>
                  <span class="font-bold text-blue-600 bg-blue-100 px-2 py-1 rounded-full ml-1"><%= session.purchase_session_id %></span>
                  <% }) %>
                </p>
              </div>
            </div>
          </div>

          <% cartItems.forEach(session => { %>
          <div class="border-b border-gray-100 last:border-b-0">
            <div class="p-4">
              <div class="flex justify-between items-center mb-4">
                <div class="flex flex-col space-y-1">
                    <h3 class="text-lg font-semibold text-gray-800">Customer: <%= session.customer_name %></h3>
                    <p class="text-sm text-gray-500">Session ID: <%= session.purchase_session_id %></p>
                    <p class="text-sm text-gray-500"><i class="fa-solid fa-clock mr-1"></i> Time: <%= new Date(session.purchase_time).toLocaleString() %></p>
                    <p class="text-sm text-gray-500">Total Amount to Pay: ₹<%= session.actual_amt_to_pay %></p>
                </div>
                <div class="flex space-x-2">
                  <form action="/admin/adminDashboard/groupPurchase/processGroupPurchase" method="POST" class="inline">
                    <input type="hidden" name="purchase_session_id" value="<%= session.purchase_session_id %>">
                    <input type="hidden" name="action" value="delete">
                    <button type="submit" class="flex items-center text-red-600 hover:text-red-800 text-sm font-medium bg-red-50 hover:bg-red-100 px-3 py-1.5 rounded-lg transition-colors" onclick="return confirm('Are you sure you want to clear this session?')">
                      <i class="fa-solid fa-trash-alt mr-1"></i> Clear Session
                    </button>
                  </form>
                  <form action="/admin/adminDashboard/groupPurchase/processGroupPurchase" method="POST" class="inline">
                    <input type="hidden" name="main_purchase_session_id" value="<%= session.purchase_session_id %>">
                    <input type="number" name="purchase_session_id" placeholder="Session ID to merge" class="rounded-lg border-gray-300 text-sm focus:ring-blue-500 focus:border-blue-500 mr-2">
                    <button type="submit" name="action" value="merge" class="bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600 transition-colors">
                      Merge
                    </button>
                  </form>
                </div>
              </div>

              <div class="overflow-x-auto rounded-lg border border-gray-200">
                <table class="min-w-full divide-y divide-gray-200">
                  <thead class="bg-gray-50">
                    <tr>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Medicine</th>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Supplier</th>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Quantity</th>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Price</th>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total</th>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                    </tr>
                  </thead>
                  <tbody class="bg-white divide-y divide-gray-200">
                    <% session.purchases.forEach(item => { %>
                    <tr class="hover:bg-gray-50 transition-colors">
                      <td class="pl-6 pr-20 py-4 whitespace-nowrap">
                        <div class="flex flex-col">
                            <div class="text-sm font-medium text-gray-900"><%= item.medicine_name %></div>
                            <div class="text-xs text-gray-500"><%= item.medicine_composition %></div>

                        </div>
                      </td>
                      <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-900"><%= item.supplier_name %></div>
                      </td>
                      <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-900"><%= item.purchased_quantity %></div>
                      </td>
                      <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-900">₹<%= item.medicine_price %></div>
                      </td>
                      <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm font-medium text-blue-600">₹<%= item.total_amt %></div>
                      </td>
                      <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        <div class="flex space-x-2">
                          <button onclick="toggleEditForm('purchase-<%= item.purchase_id %>')" class="text-blue-600 hover:text-blue-800 bg-blue-50 hover:bg-blue-100 p-2 rounded-lg transition-colors">
                            <i class="fa-solid fa-edit"></i>
                          </button>
                          <form action="/admin/adminDashboard/groupPurchase/processGroupPurchase" method="POST" class="inline">
                            <input type="hidden" name="purchase_id" value="<%= item.purchase_id %>">
                            <input type="hidden" name="action" value="deleteItem">
                            <button type="submit" class="text-red-600 hover:text-red-800 bg-red-50 hover:bg-red-100 p-2 rounded-lg transition-colors" onclick="return confirm('Are you sure you want to remove this item?')">
                              <i class="fa-solid fa-trash-alt"></i>
                            </button>
                          </form>
                        </div>
                      </td>
                    </tr>

                    <tr id="edit-form-purchase-<%= item.purchase_id %>" class="hidden">
                      <td colspan="6" class="px-6 py-4 bg-gray-50">
                        <form action="/admin/adminDashboard/groupPurchase/processGroupPurchase" method="POST" class="space-y-3">
                          <input type="hidden" name="purchase_id" value="<%= item.purchase_id %>">
                          <div class="grid grid-cols-3 gap-4">
                            <div>
                              <label class="block text-sm font-medium text-gray-700 mb-1">Medicine</label>
                              <select name="medicine_id" class="w-full rounded-lg border-gray-300 text-sm focus:ring-blue-500 focus:border-blue-500">
                                <% medicines.forEach(medicine => { %>
                                <option value="<%= medicine.medicine_id %>" <%= medicine.medicine_id === item.medicine_id ? 'selected' : '' %>><%= medicine.medicine_id %>: <%= medicine.medicine_name %></option>
                                <% }) %>
                              </select>
                            </div>

                            <div>
                              <label class="block text-sm font-medium text-gray-700 mb-1">Supplier</label>
                              <select name="supplier_id" class="w-full rounded-lg border-gray-300 text-sm focus:ring-blue-500 focus:border-blue-500">
                                <option value="">Select Supplier</option>
                                <% suppliers.forEach(supplier => { %>
                                <% const hasMedicine = supplier.medicines.some(medicine => medicine.medicine_id === item.medicine_id) %>
                                <% if (hasMedicine) { %>
                                <option value="<%= supplier.supplier_id %>" <%= supplier.supplier_id === item.supplier_id ? 'selected' : '' %>>
                                  <%= supplier.supplier_id %>: <%= supplier.supplier_name %>
                                  (Stock: <%= supplier.medicines.find(m => m.medicine_id === item.medicine_id)?.stock_quantity || 0 %>)
                                </option>
                                <% } %>
                                <% }) %>
                              </select>
                            </div>

                            <div>
                              <label class="block text-sm font-medium text-gray-700 mb-1">Quantity</label>
                              <input type="number" name="purchased_quantity" value="<%= item.purchased_quantity %>" min="1" class="w-full rounded-lg border-gray-300 text-sm focus:ring-blue-500 focus:border-blue-500">
                            </div>
                          </div>

                          <div class="flex justify-end space-x-2">
                            <button type="button" onclick="toggleEditForm('purchase-<%= item.purchase_id %>')" class="px-3 py-1.5 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors">
                              Cancel
                            </button>
                            <button type="submit" name="action" value="editItem" class="px-3 py-1.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                              Save Changes
                            </button>
                          </div>
                        </form>
                      </td>
                    </tr>
                    <% }) %>
                  </tbody>
                  <tfoot class="bg-gray-50">
                    <tr>
                      <td colspan="4" class="px-6 py-3 text-right text-sm font-medium text-gray-500">Session Total:</td>
                      <td class="px-6 py-3 text-sm font-bold text-blue-600">
                        ₹<%= session.actual_amt_to_pay %>
                      </td>
                      <td class="px-6 py-3">
                        <form action="/admin/adminDashboard/groupPurchase/processGroupPurchase" method="POST" class="inline flex items-center gap-2">
                          <input type="hidden" name="purchase_session_id" value="<%= session.purchase_session_id %>">
                          <input type="hidden" name="action" value="completePurchase">
                          <label for="discount" class="text-sm font-medium text-gray-700 mr-2 mb-1">Discount:</label>
                          <input type="number" name="discount" value="0" min="0" max="<%= session.actual_amt_to_pay %>">
                          <input type="hidden" name="customer_email" value="<%= session.customer_email %>">
                          <button type="submit" class="flex items-center text-sm bg-green-600 hover:bg-green-700 text-white px-3 py-1.5 rounded-lg transition-colors">
                            <i class="fa-solid fa-check mr-1"></i> Complete Purchase
                          </button>
                        </form>
                      </td>
                    </tr>
                  </tfoot>
                </table>
              </div>
            </div>
          </div>
          <% }) %>
        </div>
        <% } %>

        <!-- GROUP PURCHASES -->
        <h2 id="groupPurchases" class="text-xl font-semibold text-gray-800 mb-4 mt-6"><i class="fa-solid fa-layer-group text-blue-600 mr-2"></i>Group Purchases</h2>
        <div class="grid grid-cols-1 gap-6">
          <% groupPurchases.forEach(group => { %>
          <div class="bg-white rounded-xl shadow-md overflow-hidden border border-gray-100">
            <div class="p-4">
              <div class="flex justify-between items-center mb-4">
                  <h3 class="text-lg font-semibold text-gray-800">Customer: <%= group.customer_name %></h3>
                  <p class="text-sm text-gray-500">Session ID: <%= group.purchase_session_id %></p>
                  <p class="text-sm text-gray-500">Time: <%= new Date(group.purchase_time).toLocaleString() %></p>
                  <p class="text-sm text-gray-500">Total Amount to Pay: ₹<%= group.actual_amt_to_pay %></p>
              </div>
              <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                  <thead class="bg-gray-50">
                    <tr>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Medicine</th>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Supplier</th>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Quantity</th>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Price</th>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Amount</th>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                    </tr>
                  </thead>
                  <tbody class="bg-white divide-y divide-gray-200">
                    <% group.purchases.forEach(purchase => { %>
                    <tr>
                      <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        <div class="flex flex-col">
                            <div class="font-medium text-gray-900"><%= purchase.medicine_name %></div>
                            <div class="text-gray-500 text-xs"><%= purchase.medicine_composition %></div>
                        </div>
                      </td>
                      <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"><%= purchase.supplier_name %></td>
                      <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"><%= purchase.purchased_quantity %></td>
                      <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"><%= purchase.medicine_price %></td>
                      <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">₹<%= purchase.total_amt %></td>
                      <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        <div class="flex space-x-2">
                          <button onclick="toggleEditForm('purchase-<%= purchase.purchase_id %>')" class="text-blue-600 hover:text-blue-900">
                            <i class="fa-solid fa-edit"></i>
                          </button>
                          <form action="/admin/adminDashboard/groupPurchase/processGroupPurchase" method="POST" class="inline">
                            <input type="hidden" name="purchase_id" value="<%= purchase.purchase_id %>">
                            <input type="hidden" name="action" value="deleteItem">
                            <button type="submit" class="text-red-600 hover:text-red-900" onclick="return confirm('Are you sure you want to remove this item?')">
                              <i class="fa-solid fa-trash-alt"></i>
                            </button>
                          </form>
                        </div>
                      </td>
                    </tr>
                    <tr id="edit-form-purchase-<%= purchase.purchase_id %>" class="hidden">
                      <td colspan="5" class="px-6 py-4 bg-gray-50">
                        <form action="/admin/adminDashboard/groupPurchase/processGroupPurchase" method="POST" class="space-y-3">
                          <input type="hidden" name="purchase_id" value="<%= purchase.purchase_id %>">
                          <div class="grid grid-cols-3 gap-4">
                            <div>
                              <label class="block text-sm font-medium text-gray-700 mb-1">Medicine</label>
                              <select name="medicine_id" class="w-full rounded-lg border-gray-300 text-sm focus:ring-blue-500 focus:border-blue-500">
                                <% medicines.forEach(medicine => { %>
                                <option value="<%= medicine.medicine_id %>" <%= medicine.medicine_id === purchase.medicine_id ? 'selected' : '' %>><%= medicine.medicine_id %>: <%= medicine.medicine_name %></option>
                                <% }) %>
                              </select>
                            </div>

                            <div>
                              <label class="block text-sm font-medium text-gray-700 mb-1">Supplier</label>
                              <select name="supplier_id" class="w-full rounded-lg border-gray-300 text-sm focus:ring-blue-500 focus:border-blue-500">
                                <option value="">Select Supplier</option>
                                <% suppliers.forEach(supplier => { %>
                                <% const hasMedicine = supplier.medicines.some(medicine => medicine.medicine_id === purchase.medicine_id) %>
                                <% if (hasMedicine) { %>
                                <option value="<%= supplier.supplier_id %>" <%= supplier.supplier_id === purchase.supplier_id ? 'selected' : '' %>>
                                  <%= supplier.supplier_id %>: <%= supplier.supplier_name %>
                                  (Stock: <%= supplier.medicines.find(m => m.medicine_id === purchase.medicine_id)?.stock_quantity || 0 %>)
                                </option>
                                <% } %>
                                <% }) %>
                              </select>
                            </div>
                            <div>
                              <label class="block text-sm font-medium text-gray-700 mb-1">Quantity</label>
                              <input type="number" name="purchased_quantity" value="<%= purchase.purchased_quantity %>" class="w-full rounded-lg border-gray-300 text-sm focus:ring-blue-500 focus:border-blue-500" min="1">
                            </div>
                          </div>

                          <div class="flex justify-end space-x-2">
                            <button type="button" onclick="toggleEditForm('purchase-<%= purchase.purchase_id %>')" class="bg-gray-500 text-white px-3 py-1 rounded hover:bg-gray-600 transition-colors">
                              Cancel
                            </button>
                            <button type="submit" name="action" value="editItem" class="bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600 transition-colors">
                              Save Changes
                            </button>
                          </div>
                        </form>
                      </td>
                    </tr>
                    <% }) %>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          <% }) %>
        </div>

        <h2 id="paymentHistory" class="text-xl font-semibold text-gray-800 mb-4 mt-6"><i class="fa-solid fa-money-bill-wave text-blue-600 mr-2"></i>Payment History</h2>
        <div class="grid grid-cols-1 gap-6">
          <% payment.forEach(payment => { %>
          <div class="bg-white rounded-xl shadow-md overflow-hidden border border-gray-100">
            <div class="p-4">
              <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                  <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Payment ID</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Customer ID</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Customer Name</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Payment Method</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Payment Time</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Payment Amount</th>
                  </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                  <tr>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"><%= payment.payment_id %></td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"><%= payment.customer_id %></td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"><%= payment.customer_name %></td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"><%= payment.payment_method %></td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"><%= new Date(payment.payment_time).toLocaleString() %></td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">₹<%= payment.payment_amt %></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <% }) %>
        </div>

        <h2 id="invoiceHistory" class="text-xl font-semibold text-gray-800 mb-4 mt-6"><i class="fa-solid fa-file-invoice text-blue-600 mr-2"></i>Invoice History</h2>
        <div class="grid grid-cols-1 gap-6">
          <% invoice.forEach(invoice => { %>
          <div class="bg-white rounded-xl shadow-md overflow-hidden border border-gray-100">
            <div class="p-4">
              <div class="flex justify-between items-center mb-4">
                <p class="text-sm text-gray-500">Invoice ID: <%= invoice.invoice_no %></p>
                <p class="text-sm text-gray-500">Invoice Time: <%= new Date(invoice.invoice_time).toLocaleString() %></p>
                <p class="text-sm text-gray-500">Invoice Admin: <%= invoice.admin_username %></p>
              </div>
              <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                  <thead class="bg-gray-50">
                    <tr>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Medicine</th>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Composition</th>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Supplier</th>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Expiry Date</th>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Price</th>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Quantity</th>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Amount</th>
                    </tr>
                  </thead>
                  <tbody class="bg-white divide-y divide-gray-200">
                    <% 
            const medicines = invoice.medicine_names.split(',');
            const compositions = invoice.medicine_compositions.split(',');
            const suppliers = invoice.supplier_names.split(',');
            const expiryDates = invoice.medicine_expiry_dates.split(',');
            const prices = invoice.medicine_prices.split(',');
            const quantities = invoice.purchased_quantities.split(',');
            const amounts = invoice.total_amt.split(',');
            
            for(let i = 0; i < medicines.length; i++) { %>
                    <tr>
                      <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"><%= medicines[i].trim() %></td>
                      <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"><%= compositions[i].trim() %></td>
                      <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"><%= suppliers[i].trim() %></td>
                      <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"><%= expiryDates[i].trim() %></td>
                      <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">₹<%= prices[i].trim() %></td>
                      <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"><%= quantities[i].trim() %></td>
                      <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">₹<%= amounts[i].trim() %></td>
                    </tr>
                    <% } %>
                  </tbody>
                </table>
              </div>
              <div class="mt-6 overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                  <thead class="bg-gray-50">
                    <tr>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Amount to Pay</th>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Previous Balance</th>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Discount</th>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Net Total</th>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Paid Amount</th>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Payment Date</th>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Current Balance</th>
                    </tr>
                  </thead>
                  <tbody class="bg-white divide-y divide-gray-200">
                    <tr>
                      <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">₹<%= invoice.actual_amt_to_pay %></td>
                      <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">₹<%= invoice.prev_balance %></td>
                      <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">₹<%= invoice.discount %></td>
                      <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">₹<%= invoice.net_total %></td>
                      <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">₹<%= invoice.amount_paid %></td>
                      <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"><%= invoice.payment_date ? new Date(invoice.payment_date).toLocaleString() : 'N/A' %></td>
                      <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">₹<%= invoice.curr_balance %></td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          <% }) %>
        </div>
      </div>
    </main>
  </div>
</div>


<script>
  function toggleEditForm(formId) {
    document.querySelectorAll("form[id^='edit-form']").forEach(form => form.classList.add('hidden'));
    document.getElementById(`edit-form-${formId}`).classList.toggle('hidden');
  }

  function previewImage(event, formId) {
    const preview = document.getElementById(`preview-${formId}`);
    const removeBtn = document.getElementById(`remove-image-${formId}`);
    preview.src = URL.createObjectURL(event.target.files[0]);
    preview.classList.remove('hidden');
    removeBtn.classList.remove('hidden');
  }

  function removeImage(formId) {
    const preview = document.getElementById(`preview-${formId}`);
    const removeBtn = document.getElementById(`remove-image-${formId}`);
    const fileInput = document.getElementById(`photo-${formId}`);
    preview.src = '';
    preview.classList.add('hidden');
    removeBtn.classList.add('hidden');
    fileInput.value = '';
  }

  function toggleTab(id) {
    const element = document.getElementById(id);
    if (element) {
      if (element.classList.contains('hidden')) {
        element.classList.remove('hidden');
      } else {
        element.classList.add('hidden');
      }
    }
  }

  function previewImage(event) {
    const preview = document.getElementById('medicine_img_preview');
    const uploadText = document.getElementById('upload-text');
    const removeButton = document.getElementById('remove_img_button');
    const file = event.target.files[0];

    if (file) {
      preview.src = URL.createObjectURL(file);
      preview.classList.remove('hidden');
      uploadText.classList.add('hidden');
      removeButton.classList.remove('hidden');
    }
  }

  function removeImage() {
    const input = document.getElementById('medicine_img_input');
    const preview = document.getElementById('medicine_img_preview');
    const uploadText = document.getElementById('upload-text');
    const removeButton = document.getElementById('remove_img_button');

    input.value = '';
    preview.src = '';
    preview.classList.add('hidden');
    uploadText.classList.remove('hidden');
    removeButton.classList.add('hidden');
  }

  function toggleEditForm(formId) {
    const form = document.getElementById(formId);
    if (form) {
      form.classList.toggle('hidden');
    }
  }

  function toggleEditForm(formId) {
    if (formId) {
      const form = document.getElementById(`edit-form-${formId}`);
      if (form) {
        form.classList.toggle('hidden');
      }
    } else {
      document.querySelectorAll('[id^="edit-form-"]').forEach(form => {
        form.classList.add('hidden');
      });
    }
  }

  function showTab(supplierId, tabName) {
    // Hide all tab contents for this supplier
    document.querySelectorAll(`[id^="tab-content-"][id$="-${supplierId}"]`).forEach(tab => {
      tab.classList.add('hidden');
    });

    // Remove active class from all tabs
    document.querySelectorAll(`[id^="tab-"][id$="-${supplierId}"]`).forEach(tab => {
      tab.classList.remove('text-blue-600', 'border-blue-600', 'border-b-2');
      tab.classList.add('text-gray-500', 'border-transparent');
    });

    // Show selected tab content
    const selectedContent = document.getElementById(`tab-content-${tabName}-${supplierId}`);
    if (selectedContent) {
      selectedContent.classList.remove('hidden');
    }

    // Add active class to selected tab
    const selectedTab = document.getElementById(`tab-${tabName}-${supplierId}`);
    if (selectedTab) {
      selectedTab.classList.remove('text-gray-500', 'border-transparent');
      selectedTab.classList.add('text-blue-600', 'border-blue-600', 'border-b-2');
    }
  }
</script>